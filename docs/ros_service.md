# ROS service（サービス）
ROSでは、トピック通信だけでなくサービス通信を使うこともできますので、Turtlesimを用いてROSサービスを体験してみます。
- トピック通信：片方向・非同期のパブリッシュサブスクライブ通信（出版購読通信）
- サービス通信：双方向・同期のリクエストレスポンス通信（要求応答通信）

サービス名とサービスメッセージ型を決めて通信します。トピック通信はトピックメッセージ型のみでしたが、サービスメッセージ型はクライアントメッセージ型とサーバーメッセージ型の組になります。

トピック通信はセンサーのデータを送受信する時などに使用し、サービス通信はセンサーの設定を変更する時などに使用します。トピック通信では設定を正常に変更できたかどうかを確認できませんが、サービス通信では結果（正常終了／異常終了）を受け取ることができます。


## サービス名の確認
まず、TurtleSimでは、どのようなサービスが使用されているのかを確認してみます。シミュレーター実行中に下記のコマンドを実行してみてください。「/clear」や「/spawn」、「/turtle1/set_pen」などが存在していると思います。
```
$ ros2 service list
```

オプションtを付けるとサービスメッセージ型を確認することができます。
```
$ ros2 service list -t
```

## サービス通信の試用
サービスはコマンド`call`で実行できます。サービスの多くは引数（arguments）で値を指定しながら実行します。また、引数は省略できる場合があります。
```
$ ros2 service call サービス名 サービスメッセージ型
や
$ ros2 service call サービス名 サービスメッセージ型 引数
```

### 移動軌跡の消去
サービス「/clear」で全ての線（移動軌跡）を消せます。
```
$ ros2 service call /clear std_srvs/srv/Empty
```

### 亀ロボットの追加
引数「name」を空欄にし、サービス「/spawn」を実行してみます。すると、自動的に名前が与えられます（恐らくturtle2という名前が与えられます）。
```
$ ros2 service call /spawn turtlesim/srv/Spawn "{x: 2, y: 2, theta: 0.2, name: ''}"
```

引数「name」を指定する時はシングルクォーテーションマークで囲む必要がある点に注意してください。
```
$ ros2 service call /spawn turtlesim/srv/Spawn "{x: 2, y: 2, theta: 0.2, name: 'bowser'}"
```

### 移動軌跡の変更
亀ロボットを動かすと線（移動軌跡）が引かれますが、亀ごとに色を変更することができます。サービス名［/亀の名前/set_pen］で線の色（r、g、b）や線の太さ（width）を変更することができます。

色を確認しながら調整できるよう、rqtを使用しましょう。Plugins→Services→Service callerからサービスを選択します。値を変更し、ボタン「Call」を押してみましょう。
```
$ rqt
```

### 亀ロボットの削除
指定した亀ロボットがその軌跡と共に消えます。
```
《記法》
$ ros2 service call /kill turtlesim/srv/Kill "{name: '亀の名前'}"
《実例》
$ ros2 service call /kill turtlesim/srv/Kill "{name: 'bowser'}"
```

### リセット
シミュレーター実験を最初から遣り直すこともできます。
```
$ ros2 service call /reset std_srvs/srv/Empty
```

[このページのトップへ](#)

[実験用サイトのトップへ](https://stl-apu.github.io/laboratory_experiments/)
